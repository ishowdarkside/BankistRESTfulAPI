import{j as t,u as h,a as p,n as r,r as d,S as l,L as w,b as g}from"./index-538c2be6.js";import{u as m,M as _}from"./Modal-57f95691.js";import{g as f}from"./getMonths-9fb8e4cc.js";import{T as y}from"./TabBar-bdd85f35.js";import{f as v}from"./formatDate-9bcc5296.js";const b="_overview_dhu2o_1",D="_dashboardLayout_dhu2o_8",T="_balance_dhu2o_14",N="_welcomeHeading_dhu2o_21",S="_username_dhu2o_25",W="_operations_dhu2o_30",q="_requestPanel_dhu2o_54",C="_requestInput_dhu2o_72",P="_datePanel_dhu2o_84",A="_boldDate_dhu2o_93",L="_transactionPanel_dhu2o_98",F="_centerMe_dhu2o_112",$="_transactionWrapper_dhu2o_119",k="_transactionsWrapper_dhu2o_126",M="_redirectLink_dhu2o_130",R="_transactionType_dhu2o_138",I="_transAmountDeposit_dhu2o_143",O="_transAmountWithdraw_dhu2o_148",E="_nothingToShow_dhu2o_153",H="_centerType_dhu2o_163",a={overview:b,dashboardLayout:D,balance:T,welcomeHeading:N,username:S,operations:W,requestPanel:q,requestInput:C,datePanel:P,boldDate:A,transactionPanel:L,centerMe:F,transactionWrapper:$,transactionsWrapper:k,redirectLink:M,transactionType:R,transAmountDeposit:I,transAmountWithdraw:O,nothingToShow:E,centerType:H};function V({name:e,balance:n}){var s,o;return t.jsxs("div",{className:a.overview,children:[t.jsxs("h3",{className:a.welcomeHeading,children:["Welcome back,",t.jsx("span",{className:a.username,children:` ${((s=e==null?void 0:e[0])==null?void 0:s.toUpperCase())+((o=e==null?void 0:e.toLowerCase())==null?void 0:o.slice(1))}`})]}),t.jsx("p",{children:"Balance:"}),t.jsxs("span",{className:a.balance,children:["$",n==null?void 0:n.toFixed(2)]})]})}const Q="_depositForm_ugepn_1",B="_withdrawForm_ugepn_27",j={depositForm:Q,withdrawForm:B};async function J(e){return await(await fetch("/api/banking/deposit",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({depositValue:+e})})).json()}function K(){const{dispatch:e}=h(),n=p();return m({mutationFn:s=>J(s),onSuccess:s=>{e({type:"modal/close"}),s.status==="success"&&(r.success(s.message),n.invalidateQueries({queryKey:["user"]}),r("Deposit cooldown 5 minutes",{duration:3e5,icon:"⏰",position:"bottom-right"})),s.status==="fail"&&r.error(`${s.message} `)},onError:s=>{r.error(s.message)}})}async function U(e){return await(await fetch("/api/banking/withdraw",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bear ${document.cookie}`},body:JSON.stringify({withdrawValue:+e})})).json()}function z(){const e=p(),{dispatch:n}=h();return m({mutationFn:s=>U(s),onSuccess:s=>{n({type:"modal/close"}),s.status==="fail"&&r.error(s.message),s.status==="success"&&(r.success(s.message),r("Withdraw cooldown 5 minutes",{duration:3e5,icon:"⏰",position:"bottom-right"}),e.invalidateQueries({queryKey:["user"]}))},onError:s=>r.error(s.message)})}function G(){const{currOpenModal:e,dispatch:n}=h();return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:a.operations,children:[t.jsx("div",{onClick:()=>n({type:"modal/deposit"}),children:"DEPOSIT"}),t.jsx("div",{onClick:()=>n({type:"modal/withdraw"}),children:"WITHDRAW"})]}),e==="deposit"&&t.jsx(_,{children:t.jsx(X,{})}),e==="withdraw"&&t.jsx(_,{children:t.jsx(Y,{})})]})}function X(){const[e,n]=d.useState(""),{mutate:s,isLoading:o}=K();async function c(){s(e)}return o?t.jsx(l,{}):t.jsxs("form",{className:j.depositForm,onSubmit:i=>{i.preventDefault(),c()},children:[t.jsx("span",{children:"Deposit money:"}),t.jsxs("div",{children:[t.jsx("img",{src:"/money.svg"}),t.jsx("input",{type:"number",placeholder:"$",value:e,onChange:i=>n(i.target.value)})]}),t.jsx("button",{children:"DEPOSIT"})]})}function Y(){const[e,n]=d.useState(""),{mutate:s,isLoading:o}=z();function c(){s(e)}return o?t.jsx(l,{}):t.jsxs("form",{className:j.withdrawForm,onSubmit:i=>{i.preventDefault(),c()},children:[t.jsx("span",{children:"Withdraw money:"}),t.jsxs("div",{children:[t.jsx("img",{src:"/money.svg"}),t.jsx("input",{type:"number",placeholder:"$",value:e,onChange:i=>n(i.target.value)})]}),t.jsx("button",{children:"WITHDRAW"})]})}async function Z(e,n){return(await fetch("/api/banking/request",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({recipient:e,value:n})})).json()}function ee(){const e=p();return m({mutationFn:({recipient:n,amount:s})=>Z(n,s),onSuccess:n=>{n.status==="success"&&(r.success(n.message),e.invalidateQueries({queryKey:["user"]})),n.status==="fail"&&r.error(n.message)},onError:n=>r.error(n.message)})}function te(){const[e,n]=d.useState(""),[s,o]=d.useState(""),{mutate:c,isLoading:i}=ee();function x(){!s||!e||(c({recipient:e,amount:s}),n(""),o(""))}return i?t.jsx("div",{className:a.requestPanel,style:{position:"relative",height:"21rem"},children:t.jsx(l,{})}):t.jsxs("form",{className:a.requestPanel,onSubmit:u=>{u.preventDefault(),x()},children:[t.jsx("h3",{children:"Request Money"}),t.jsx("input",{type:"text",placeholder:"Recipients email",className:a.requestInput,value:e,onChange:u=>n(u.target.value)}),t.jsx("input",{type:"number",placeholder:"$",className:a.requestInput,value:s,onChange:u=>o(u.target.value)}),t.jsx("button",{children:"Request"})]})}function se(){const e=f();return t.jsxs("div",{className:a.datePanel,children:[t.jsx("span",{className:a.boldDate,children:new Date().getDate()}),t.jsx("span",{children:e[new Date().getMonth()]})]})}function ne({transactions:e}){var n;return t.jsxs("div",{className:a.transactionPanel,children:[t.jsx("h3",{children:"Latest transactions"}),t.jsx(y,{}),t.jsxs("div",{className:a.transactionsWrapper,children:[(e==null?void 0:e.length)>0&&((n=e==null?void 0:e.slice(-6).reverse())==null?void 0:n.map(s=>t.jsx(ae,{type:s.transactionType,date:s.transactionDate,value:s.value},s._id))),(e==null?void 0:e.length)===0&&t.jsx("span",{className:a.nothingToShow,children:"NO RECENT TRANSACTIONS."})]}),e.length>6&&t.jsx(w,{to:"/app/history",className:a.redirectLink,children:"View more"})]})}function ae({type:e,date:n,value:s}){const o=v(n);return t.jsxs("div",{className:a.transactionWrapper,children:[t.jsx("span",{className:a.transactionDate,children:o}),t.jsxs("span",{className:`${a.transactionType} ${a.centerType}`,children:[t.jsx("img",{src:e==="deposit"?"/arrowDeposit.svg":"/arrowWithdraw.svg"}),e]}),t.jsx("span",{className:e==="deposit"?a.transAmountDeposit:a.transAmountWithdraw,children:e==="deposit"?`+$${s}`:`-$${s}`})]})}function de(){const{user:e}=g();return e?t.jsx("div",{className:a.dashboardLayout,children:e&&t.jsxs(t.Fragment,{children:[t.jsx(V,{name:e==null?void 0:e.name,balance:e==null?void 0:e.balance}),t.jsx(G,{}),t.jsx(te,{}),t.jsx(se,{}),t.jsx(ne,{transactions:e==null?void 0:e.transactions})]})}):t.jsx(l,{})}export{de as default};
