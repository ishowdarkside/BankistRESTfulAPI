import{a as d,n as r,b as h,u as c,j as e,S as i,r as f}from"./index-538c2be6.js";import{f as x}from"./formatDate-9bcc5296.js";import{u as m,M as u}from"./Modal-57f95691.js";import"./getMonths-9fb8e4cc.js";async function y(a){try{return await(await fetch("/api/banking/requestLoan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({loanAmount:+a})})).json()}catch(n){throw new Error(n)}}function j(){const a=d();return m({mutationFn:n=>y(n),onSuccess:n=>{n.status==="success"&&(r.success(n.message),a.invalidateQueries(["user"])),n.status==="fail"&&r.error(n.message)},onError:n=>r.error(n.message)})}const _="_requestPanel_11972_1",L="_loanForm_11972_17",g="_closeForm_11972_26",P="_elementsWrapper_11972_35",b="_hasLoanPanel_11972_66",q="_alert_11972_75",N="_payLoanPanel_11972_79",w="_triggerModal_11972_101",C="_loanAlert_11972_112",A="_flex_11972_117",v="_loanInfo_11972_124",s={requestPanel:_,loanForm:L,closeForm:g,elementsWrapper:P,hasLoanPanel:b,alert:q,payLoanPanel:N,triggerModal:w,loanAlert:C,flex:A,loanInfo:v};async function F(){try{return await(await fetch("/api/banking/payLoan")).json()}catch(a){throw new Error(a)}}function S(){const a=d();return m({mutationFn:F,onSuccess:n=>{n.status==="success"&&(r.success(n.message),a.invalidateQueries(["user"])),n.status==="fail"&&r.error(n.message)},onError:n=>r.err(n.message)})}function W(){const{isLoading:a,user:n}=h(),{dispatch:t,currOpenModal:o}=c();return a?e.jsx(i,{}):n.hasLoan?e.jsxs("div",{className:s.hasLoanPanel,children:[e.jsx("span",{className:s.alert,children:"You can not request a loan until you pay off your last loan."}),e.jsx("button",{className:s.triggerModal,onClick:()=>t({type:"payLoan"}),children:"PAY LOAN NOW!"}),o==="payLoan"&&e.jsx(u,{children:e.jsx(k,{user:n})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:s.requestPanel,children:!n.hasLoan&&e.jsxs("div",{className:s.flex,children:[e.jsx("span",{className:s.loanInfo,children:"Hello and welcome to the loan panel.Belove, push the button down to request a loan. Your maximum borrowing amount is determined by your current account balance."}),e.jsx("button",{onClick:()=>t({type:"modal/loan"}),children:"Request a laon"})]})}),o==="loan"&&e.jsx(u,{children:e.jsx(M,{})})]})}function M(){const{dispatch:a}=c(),{mutate:n,isLoading:t}=j(),[o,p]=f.useState("");return t?e.jsx(i,{}):e.jsxs("form",{className:s.loanForm,onSubmit:l=>{l.preventDefault(),n(o,{onSuccess:()=>a({type:"reset"}),onError:()=>a({type:"rest"})})},children:[e.jsx("h2",{children:"Request a loan"}),e.jsxs("div",{className:s.elementsWrapper,children:[e.jsx("input",{type:"number",placeholder:"Loan amount",value:o,onChange:l=>p(l.target.value)}),e.jsx("button",{children:"Request loan now!"}),e.jsx("button",{onClick:()=>a({type:"reset"}),children:"Cancel"})]})]})}function k({user:a}){const{dispatch:n}=c(),{mutate:t,isLoading:o}=S();return o?e.jsx(i,{}):e.jsxs("div",{className:s.payLoanPanel,children:[e.jsxs("span",{children:["Loan amount: ",e.jsxs("b",{children:["$",a.loan]})]}),e.jsxs("span",{children:["Loan requested at: ",e.jsx("i",{children:x(a.loanRequestedAt)})]}),e.jsxs("span",{className:s.loanAlert,children:["If you proceed to pay a loan, your account will be charged for additional $",a.loan]}),e.jsx("button",{onClick:()=>t(null,{onSuccess:()=>n({type:"reset"})}),children:"PAY LOAN"}),e.jsx("button",{onClick:()=>n({type:"reset"}),children:"Cancel"})]})}export{W as default};
