import{a as j,n as o,b as v,u as l,r as _,j as e,S as d}from"./index-a1aee26a.js";import{f as g}from"./formatDate-9bcc5296.js";import{I as y}from"./InfoPanel-21fdd1a5.js";import{u as f,M as h}from"./Modal-2eaebde0.js";import{P as k}from"./Pagination-7d2a28e8.js";import"./getMonths-9fb8e4cc.js";const A="_requestElement_1j5fk_1",E="_recipientInfo_1j5fk_10",N="_recipientFullName_1j5fk_14",C="_notApproved_1j5fk_18",R="_approved_1j5fk_22",b="_requestPlaceholder_1j5fk_26",P="_btnWrapper_1j5fk_31",w="_requestAmount_1j5fk_52",D="_requestsWrapper_1j5fk_56",S="_modal_1j5fk_66",r={requestElement:A,recipientInfo:E,recipientFullName:N,notApproved:C,approved:R,requestPlaceholder:b,btnWrapper:P,requestAmount:w,requestsWrapper:D,modal:S};async function W(t){try{return await(await fetch(`/api/banking/request/${t}`,{method:"GET",headers:{Authorization:`Bearer ${document.cookie}`}})).json()}catch(s){throw new Error(s)}}function F(){const t=j();return f({mutationFn:s=>W(s),onSuccess:s=>{s.status==="success"&&(t.invalidateQueries(["user"]),o.success(s.message)),s.status==="fail"&&o.error(s.message)},onError:s=>o.error(s.message)})}async function I(t){try{return await(await fetch(`/api/banking/request/decline/${t}`,{method:"GET",headers:{Authorization:`Bearer ${document.cookie}`}})).json()}catch(s){throw new Error(s)}}function M(){const t=j();return f({mutationFn:I,onSuccess:s=>{s.status==="success"&&(t.invalidateQueries(["user"]),o.success(s.message)),s.status==="fail"&&o.error(s.message)},onError:s=>o.error(s.message)})}function V(){const{isLoading:t,user:s}=v(),{activeRequest:n,currOpenModal:a}=l(),[c,u]=_.useState(1);if(t)return e.jsx(d,{});const{receivedRequests:i}=s,x=-5*c,q=c==1?i.length:-5*c+5,p=i.slice(x,q).reverse();return i.length===0?e.jsx("span",{children:"No received requests"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:r.requestsWrapper,children:[e.jsx(y,{}),e.jsx("div",{className:r.requestsWrapper,children:p.map(m=>e.jsx(O,{request:m},m._id))})]}),e.jsx(k,{arr:i,paginatedArr:p,maxNum:5,page:c,setterFunc:u}),a==="accept"&&e.jsx(h,{children:e.jsx(T,{request:n})}),a==="decline"&&e.jsx(h,{children:e.jsx($,{request:n})})]})}function O({request:t}){const{approved:s,receiver:n,value:a,requestDate:c}=t,{dispatch:u}=l(),i=g(c);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:r.requestElement,children:[e.jsx("span",{className:s?r.approved:r.notApproved,children:s?"APPROVED":"NOT APPROVED"}),e.jsxs("div",{className:r.recipientInfo,children:[e.jsx("span",{className:r.requestPlaceholder,children:"Request received from:"}),e.jsx("span",{className:r.recipientEmail,children:n.email})]}),e.jsx("span",{children:i}),e.jsxs("span",{className:r.requestAmount,children:["$",a]}),!s&&e.jsxs("div",{className:r.btnWrapper,children:[e.jsx("button",{onClick:()=>u({type:"request/assign",payload:{value:t,currOpenModal:"accept"}}),children:"ACCEPT"}),e.jsx("button",{onClick:()=>u({type:"request/assign",payload:{value:t,currOpenModal:"decline"}}),children:"DECLINE"})]})]})})}function T({request:t}){const{dispatch:s}=l(),{mutate:n,isLoading:a}=F();return a?e.jsx(d,{}):e.jsxs("div",{className:r.modal,children:[e.jsxs("span",{children:["Are you sure you want to accept this request? Your account will be charged for additional $",t.value,"."]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>n(t._id,{onSuccess:()=>s({type:"reset"})}),children:"ACCEPT"}),e.jsx("button",{onClick:()=>s({type:"reset"}),children:"CANCEL"})]})]})}function $({request:t}){const{dispatch:s}=l(),{mutate:n,isLoading:a}=M();return a?e.jsx(d,{}):e.jsxs("div",{className:r.modal,children:[e.jsxs("span",{children:["Are you sure you want to decline this request? This action is irreversible. If you change your mind, ",t.receiver.name," will have to make a request again."]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>n(t._id,{onSuccess:()=>s({type:"reset"})}),children:"Yes, i am sure"}),e.jsx("button",{onClick:()=>s({type:"reset"}),children:"Cancel"})]})]})}export{V as default};
