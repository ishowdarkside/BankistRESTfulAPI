import{a as d,n as r,b as h,u as c,j as e,S as i,r as f}from"./index-a1aee26a.js";import{f as x}from"./formatDate-9bcc5296.js";import{u as m,M as u}from"./Modal-2eaebde0.js";import"./getMonths-9fb8e4cc.js";async function y(a){try{return await(await fetch("/api/banking/requestLoan",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${document.cookie}`},body:JSON.stringify({loanAmount:+a})})).json()}catch(n){throw new Error(n)}}function j(){const a=d();return m({mutationFn:n=>y(n),onSuccess:n=>{n.status==="success"&&(r.success(n.message),a.invalidateQueries(["user"])),n.status==="fail"&&r.error(n.message)},onError:n=>r.error(n.message)})}const _="_requestPanel_11972_1",L="_loanForm_11972_17",g="_closeForm_11972_26",P="_elementsWrapper_11972_35",b="_hasLoanPanel_11972_66",q="_alert_11972_75",A="_payLoanPanel_11972_79",N="_triggerModal_11972_101",w="_loanAlert_11972_112",C="_flex_11972_117",v="_loanInfo_11972_124",o={requestPanel:_,loanForm:L,closeForm:g,elementsWrapper:P,hasLoanPanel:b,alert:q,payLoanPanel:A,triggerModal:N,loanAlert:w,flex:C,loanInfo:v};async function F(){try{return await(await fetch("/api/banking/payLoan",{method:"GET",headers:{Authorization:`Bearer ${document.cookie}`}})).json()}catch(a){throw new Error(a)}}function S(){const a=d();return m({mutationFn:F,onSuccess:n=>{n.status==="success"&&(r.success(n.message),a.invalidateQueries(["user"])),n.status==="fail"&&r.error(n.message)},onError:n=>r.err(n.message)})}function W(){const{isLoading:a,user:n}=h(),{dispatch:s,currOpenModal:t}=c();return a?e.jsx(i,{}):n.hasLoan?e.jsxs("div",{className:o.hasLoanPanel,children:[e.jsx("span",{className:o.alert,children:"You can not request a loan until you pay off your last loan."}),e.jsx("button",{className:o.triggerModal,onClick:()=>s({type:"payLoan"}),children:"PAY LOAN NOW!"}),t==="payLoan"&&e.jsx(u,{children:e.jsx(E,{user:n})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:o.requestPanel,children:!n.hasLoan&&e.jsxs("div",{className:o.flex,children:[e.jsx("span",{className:o.loanInfo,children:"Hello and welcome to the loan panel.Belove, push the button down to request a loan. Your maximum borrowing amount is determined by your current account balance."}),e.jsx("button",{onClick:()=>s({type:"modal/loan"}),children:"Request a laon"})]})}),t==="loan"&&e.jsx(u,{children:e.jsx(k,{})})]})}function k(){const{dispatch:a}=c(),{mutate:n,isLoading:s}=j(),[t,p]=f.useState("");return s?e.jsx(i,{}):e.jsxs("form",{className:o.loanForm,onSubmit:l=>{l.preventDefault(),n(t,{onSuccess:()=>a({type:"reset"}),onError:()=>a({type:"rest"})})},children:[e.jsx("h2",{children:"Request a loan"}),e.jsxs("div",{className:o.elementsWrapper,children:[e.jsx("input",{type:"number",placeholder:"Loan amount",value:t,onChange:l=>p(l.target.value)}),e.jsx("button",{children:"Request loan now!"}),e.jsx("button",{onClick:()=>a({type:"reset"}),children:"Cancel"})]})]})}function E({user:a}){const{dispatch:n}=c(),{mutate:s,isLoading:t}=S();return t?e.jsx(i,{}):e.jsxs("div",{className:o.payLoanPanel,children:[e.jsxs("span",{children:["Loan amount: ",e.jsxs("b",{children:["$",a.loan]})]}),e.jsxs("span",{children:["Loan requested at: ",e.jsx("i",{children:x(a.loanRequestedAt)})]}),e.jsxs("span",{className:o.loanAlert,children:["If you proceed to pay a loan, your account will be charged for additional $",a.loan]}),e.jsx("button",{onClick:()=>s(null,{onSuccess:()=>n({type:"reset"})}),children:"PAY LOAN"}),e.jsx("button",{onClick:()=>n({type:"reset"}),children:"Cancel"})]})}export{W as default};
